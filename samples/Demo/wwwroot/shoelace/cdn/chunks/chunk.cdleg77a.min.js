/**
 * Minified by jsDelivr using Terser v5.37.0.
 * Original file: /npm/@shoelace-style/shoelace@2.19.1/cdn/chunks/chunk.CDLEG77A.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{getTabbableElements}from"./chunk.LXDTFLWU.js";import{__yieldStar}from"./chunk.W27M6RDR.js";function*activeElements(e=document.activeElement){null!=e&&(yield e,"shadowRoot"in e&&e.shadowRoot&&"closed"!==e.shadowRoot.mode&&(yield*__yieldStar(activeElements(e.shadowRoot.activeElement))))}function getDeepestActiveElement(){return[...activeElements()].pop()}var activeModals=[],Modal=class{constructor(e){this.tabDirection="forward",this.handleFocusIn=()=>{this.isActive()&&this.checkFocus()},this.handleKeyDown=e=>{var t;if("Tab"!==e.key||this.isExternalActivated)return;if(!this.isActive())return;const s=getDeepestActiveElement();if(this.previousFocus=s,this.previousFocus&&this.possiblyHasTabbableChildren(this.previousFocus))return;e.shiftKey?this.tabDirection="backward":this.tabDirection="forward";const i=getTabbableElements(this.element);let n=i.findIndex((e=>e===s));this.previousFocus=this.currentFocus;const o="forward"===this.tabDirection?1:-1;for(;;){n+o>=i.length?n=0:n+o<0?n=i.length-1:n+=o,this.previousFocus=this.currentFocus;const s=i[n];if("backward"===this.tabDirection&&this.previousFocus&&this.possiblyHasTabbableChildren(this.previousFocus))return;if(s&&this.possiblyHasTabbableChildren(s))return;e.preventDefault(),this.currentFocus=s,null==(t=this.currentFocus)||t.focus({preventScroll:!1});const a=[...activeElements()];if(a.includes(this.currentFocus)||!a.includes(this.previousFocus))break}setTimeout((()=>this.checkFocus()))},this.handleKeyUp=()=>{this.tabDirection="forward"},this.element=e,this.elementsWithTabbableControls=["iframe"]}activate(){activeModals.push(this.element),document.addEventListener("focusin",this.handleFocusIn),document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keyup",this.handleKeyUp)}deactivate(){activeModals=activeModals.filter((e=>e!==this.element)),this.currentFocus=null,document.removeEventListener("focusin",this.handleFocusIn),document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp)}isActive(){return activeModals[activeModals.length-1]===this.element}activateExternal(){this.isExternalActivated=!0}deactivateExternal(){this.isExternalActivated=!1}checkFocus(){if(this.isActive()&&!this.isExternalActivated){const e=getTabbableElements(this.element);if(!this.element.matches(":focus-within")){const t=e[0],s=e[e.length-1],i="forward"===this.tabDirection?t:s;"function"==typeof(null==i?void 0:i.focus)&&(this.currentFocus=i,i.focus({preventScroll:!1}))}}}possiblyHasTabbableChildren(e){return this.elementsWithTabbableControls.includes(e.tagName.toLowerCase())||e.hasAttribute("controls")}};export{Modal};
//# sourceMappingURL=/sm/c3ff524aa4b2791ba57f97a6035a84a8cb7e426b6145436092b1b8396477f0e6.map